<!-- This template is now unused. All ticket views use ticket_print.html for consistency. -->
                        <p class="text-green-100">Waka-Fine Bus</p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-green-100">PNR</p>
                        <p class="text-base font-bold">{{ booking.pnr_code }}</p>
                    </div>
                </div>
            </div>

            <!-- Ticket Body -->
            <div class="p-4">
                <!-- Route Information -->
                <div class="flex justify-between items-center mb-6">
                    <div class="text-center">
                        <p class="text-2xl font-bold text-gray-800">{{ booking.route.origin }}</p>
                        <p class="text-sm text-gray-600">{{ booking.route.departure_time|time:"H:i" }}</p>
                    </div>
                    <div class="flex-1 px-4">
                        <div class="relative">
                            <div class="flex items-center">
                                <div class="flex-1 border-t-2 border-dashed border-gray-300"></div>
                                <div class="px-3">
                                    <i class="fas fa-bus text-primary text-xl"></i>
                                </div>
                                <div class="flex-1 border-t-2 border-dashed border-gray-300"></div>
                            </div>
                        </div>
                    </div>
                    <div class="text-center">
                        <p class="text-2xl font-bold text-gray-800">{{ booking.route.destination }}</p>
                        <p class="text-sm text-gray-600">{{ booking.route.arrival_time|time:"H:i" }}</p>
                    </div>
                </div>

                <!-- Travel Details -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <p class="text-xs text-gray-600 uppercase">Date</p>
                        <p class="font-semibold">{{ booking.travel_date|date:"M d, Y" }}</p>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <p class="text-xs text-gray-600 uppercase">Trip Type</p>
                        <p class="font-semibold">
                            {% if booking.trip_type == "round_trip" %}
                                <span class="text-blue-600">Round Trip</span>
                            {% else %}
                                One Way
                            {% endif %}
                        </p>
                    </div>
                    
                    <!-- Return Trip Details - exactly like payment_success.html -->
                    {% if booking.trip_type == "round_trip" and booking.return_date %}
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <p class="text-xs text-blue-600 uppercase">Return Date</p>
                        <p class="font-semibold text-blue-800">{{ booking.return_date|date:"M d, Y" }}</p>
                    </div>
                    {% endif %}
                    {% if booking.trip_type == "round_trip" and booking.return_bus %}
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <p class="text-xs text-blue-600 uppercase">Return Bus</p>
                        <p class="font-semibold text-blue-800">{{ booking.return_bus.bus_name }}</p>
                    </div>
                    {% endif %}
                    {% if booking.trip_type == "round_trip" and booking.return_seat %}
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <p class="text-xs text-blue-600 uppercase">Return Seat</p>
                        <p class="font-semibold text-blue-800">{{ booking.return_seat.seat_number }}</p>
                    </div>
                    {% endif %}
                    
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <p class="text-xs text-gray-600 uppercase">Bus</p>
                        <p class="font-semibold">{{ booking.bus.bus_name }}</p>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <p class="text-xs text-gray-600 uppercase">Seat</p>
                        <p class="font-semibold">{{ booking.seat.seat_number }}</p>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <p class="text-xs text-gray-600 uppercase">Amount</p>
                        <p class="font-semibold">Le {{ booking.amount_paid|floatformat:0 }}</p>
                    </div>
                </div>

                <!-- Passenger Information -->
                <div class="border-t pt-4 mb-6">
                    <p class="text-xs text-gray-600 uppercase mb-2">Passenger</p>
                    <p class="font-semibold text-lg">{{ booking.customer.get_full_name|default:booking.customer.username }}</p>
                    <p class="text-gray-600">{{ booking.customer.email }}</p>
                </div>
                
                <!-- Payment Information -->
                <div class="border-t pt-4 mb-6">
                    <p class="text-xs text-gray-600 uppercase mb-2">Payment Details</p>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Method:</span>
                            <span class="font-semibold">{{ booking.get_payment_method_display }}</span>
                        </div>
                        {% if booking.mobile_money_number %}
                        <div class="flex justify-between">
                            <span class="text-gray-600">Mobile Number:</span>
                            <span class="font-semibold">{{ booking.mobile_money_number }}</span>
                        </div>
                        {% endif %}
                        <div class="flex justify-between">
                            <span class="text-gray-600">Amount:</span>
                            <span class="font-semibold text-primary">Le {{ booking.amount_paid|floatformat:0 }}</span>
                        </div>
                    </div>
                </div>

                <!-- QR Code -->
                <div class="text-center border-t pt-6">
                    <div class="bg-white p-4 inline-block rounded-lg border-2 border-dashed border-gray-300">
                        <div id="qr-code" class="qr-code-container mb-2 flex justify-center"></div>
                        <p class="text-xs text-gray-600">Scan QR code for verification</p>
                    </div>
                </div>
            </div>

            <!-- Ticket Footer -->
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-3 border-t">
                <p class="text-xs text-blue-100 text-center">
                    Please present this ticket at the boarding point. Keep your ID ready for verification.
                </p>
            </div>
        </div>
    </div>

    <!-- Actions -->
    <div class="mt-8 space-y-4 no-print">
        <div class="flex flex-wrap gap-4 justify-center">
            <button onclick="printTicket()" 
                    class="bg-gray-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-gray-700 transition-colors duration-200 flex items-center no-print" id="print-button">
                <i class="fas fa-print mr-2"></i>
                Print Ticket
            </button>

            <a href="{% url 'bookings:list' %}" 
               class="bg-gray-100 text-gray-700 py-3 px-6 rounded-lg font-medium hover:bg-gray-200 transition-colors duration-200 flex items-center no-print">
                <i class="fas fa-list mr-2"></i>
                All Bookings
            </a>
        </div>
    </div>
</div>

{% comment %} /* Unified QR Code Script */ {% endcomment %}

<!-- QR Code Library and Unified Generator -->
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
<script src="{% static 'js/waka-fine-qr.js' %}"></script>

<noscript>
    <div class="qr-fallback" style="width: 130px; height: 130px; border: 3px solid #2563eb; border-radius: 4px; display: flex; align-items: center; justify-content: center; background: white; margin: 0 auto;">
        <div style="text-align: center; color: #2563eb;">
            <div style="font-size: 14px; font-weight: bold; margin-bottom: 4px;">ðŸŽ« TICKET</div>
            <div style="font-size: 12px; font-family: monospace; font-weight: bold;">{{ booking.pnr_code }}</div>
            <div style="font-size: 10px; margin-top: 4px; opacity: 1;">{{ booking.route.origin }} â†’ {{ booking.route.destination }}</div>
            {% if booking.trip_type == "round_trip" %}
            <div style="font-size: 9px; margin-top: 2px; color: #1d4ed8;">ROUND TRIP</div>
            {% endif %}
        </div>
    </div>
</noscript>

<script>
    // Print button logic (retained)
    function printTicket() {
        const printButton = document.getElementById('print-button');
        printButton.disabled = true;
        printButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Preparing...';
        let waitAttempts = 20;
        const waitInterval = setInterval(function() {
            if (window.qrCodeReady || waitAttempts <= 0) {
                clearInterval(waitInterval);
                window.print();
                setTimeout(() => {
                    printButton.disabled = false;
                    printButton.innerHTML = '<i class="fas fa-print mr-2"></i>Print Ticket';
                }, 1500);
            }
            waitAttempts--;
        }, 100);
    }

    // Unified QR code generation - matches payment_success.html exactly  
    document.addEventListener('DOMContentLoaded', function() {
        console.log('ðŸŽ« Ticket Simple QR Code generation starting...');
        
        // Prepare booking data with comprehensive round trip handling - matches payment_success.html
        const bookingData = {
            pnr: '{{ booking.pnr_code|escapejs }}',
            origin: '{{ booking.route.origin|escapejs }}',
            destination: '{{ booking.route.destination|escapejs }}',
            date: '{{ booking.travel_date|date:"M d, Y"|escapejs }}',
            time: '{{ booking.travel_date|date:"H:i"|escapejs }}',
            bus: '{{ booking.bus.bus_name|escapejs }}',
            seat: '{{ booking.seat.seat_number|escapejs }}',
            passenger: '{{ booking.customer.get_full_name|default:booking.customer.username|escapejs }}',
            amount: 'Le {{ booking.amount_paid|floatformat:0|escapejs }}',
            payment: '{{ booking.get_payment_method_display|escapejs }}',
            status: '{{ booking.get_status_display|escapejs }}',
            trip_type: '{{ booking.trip_type|escapejs }}',
            
            // Round trip handling - only include if actually round trip with data
            {% if booking.trip_type == "round_trip" %}
            is_round_trip: true,
            {% if booking.return_date %}
            return_date: '{{ booking.return_date|date:"M d, Y"|escapejs }}',
            return_time: '{{ booking.return_date|date:"H:i"|escapejs }}',
            {% endif %}
            {% if booking.return_bus %}
            return_bus: '{{ booking.return_bus.bus_name|escapejs }}',
            {% endif %}
            {% if booking.return_seat %}
            return_seat: '{{ booking.return_seat.seat_number|escapejs }}',
            {% endif %}
            {% else %}
            is_round_trip: false,
            {% endif %}
        };
        
        const qrContainer = document.getElementById('qr-code');
        
        // Use unified QR generator with current URL - exactly like payment_success.html approach
        generateWakaFineQRCode(bookingData, qrContainer, {
            useCurrentUrl: true,
            showLogs: true,
            width: 130,
            height: 130
        });
    });
</script>

{% endblock %}
